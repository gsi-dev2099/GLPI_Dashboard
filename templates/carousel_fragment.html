<div class="d-flex align-items-center mb-2 px-1">
    <h6 class="text-uppercase fw-bold mb-0 tracking-wide text-primary"
        style="font-size: 0.8rem; letter-spacing: 0.5px;">
        <i class="bi bi-kanban me-2"></i>En Proceso
    </h6>
    <span class="badge bg-secondary/10 text-secondary border border-secondary/20 ms-2 rounded-pill"
        style="font-size: 0.7rem; padding: 0.25em 0.6em;">{{ tickets|length }}</span>
</div>

<div id="ticket-list-container" class="flex-grow-1 overflow-auto p-1 custom-scrollbar"
    style="max-height: calc(100vh - 200px);">
    {% if tickets %}
    <div class="d-flex flex-column gap-3">
        {% for ticket in tickets %}
        {# status class logic #}
        {% set status_class = ticket.estado.replace(' ', '-') %}
        {% if ticket.status_id == 3 %}{% set status_class = 'Planificado' %}{% endif %}

        <!-- Wide Card: w-100, min-height ~160px -->
        <div class="glass-card w-100 p-4 d-flex flex-column {% if ticket.es_soporte_sd == 1 %}border-start border-3 border-pastel-blue{% else %}border-start border-3 border-pastel-grey opacity-75{% endif %} shadow-sm transition-all hover-elevate"
            style="min-height: 160px;">

            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="d-flex align-items-center gap-2">
                    <span class="badge bg-light text-dark border live-timer py-1 px-2 fw-normal"
                        data-start="{{ ticket.fecha_iso }}" style="font-size: 0.9rem; font-family: monospace;">
                        <i class="bi bi-stopwatch"></i> --
                    </span>
                    <small class="text-muted" style="font-size: 0.85rem;">#{{ ticket.ticket_id }}</small>
                </div>
                <span class="badge status-pill status-{{ status_class }} py-1 px-3 fw-bold text-uppercase"
                    style="font-size: 0.85rem; letter-spacing: 0.8px;">
                    {{ ticket.estado }}
                </span>
            </div>

            <!-- Title (Large font) -->
            <h6 class="ticket-card-title mb-2 text-truncate-2 lh-sm text-dark fw-bold" title="{{ ticket.titulo }}"
                style="font-size: 1.3rem; flex-grow: 1;">
                {{ ticket.titulo }}
            </h6>

            <!-- Footer -->
            <div class="mt-auto pt-2 border-top border-light-subtle w-100">
                <div class="d-flex justify-content-between align-items-center">
                    <span class="text-muted text-truncate d-flex align-items-center"
                        style="font-size: 1rem; max-width: 45%;">
                        <i class="bi bi-person me-2"></i>{{ ticket.solicitante.split(',')[0] }}
                    </span>
                    <span class="text-primary fw-bold text-truncate d-flex align-items-center justify-content-end"
                        style="font-size: 1rem; max-width: 50%;">
                        <i class="bi bi-headset me-2"></i>{{ ticket.tecnico.split(',')[0] or 'N/A' }}
                    </span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div
        class="h-100 d-flex flex-column justify-content-center align-items-center text-secondary opacity-50 animate-fade-in">
        <i class="bi bi-cup-hot mb-2" style="font-size: 2rem;"></i>
        <h5 class="fw-light text-uppercase small" style="letter-spacing: 1px;">Sin tickets activos</h5>
    </div>
    {% endif %}
</div>

<script>
    (function () {
        if (window.ticketRotationInterval) {
            clearInterval(window.ticketRotationInterval);
        }
        if (window.inboxTimerUpdate) window.inboxTimerUpdate();
    })();
</script>